version: 0.2
phases:
  install:
    commands:
      - yum install -y tree
      - yarn
      - pip install twine
  build:
    commands:
      - npx projen release
      - echo "npx typedoc --tsconfig ./tsconfig.dev.json"
  post_build:
    commands:
      - aws codeartifact login --tool npm --repository jsii --domain "${CODE_ARTIFACT_DOMAIN}" --domain-owner "${CODE_ARTIFACT_OWNER}"
      - aws codeartifact login --tool twine --repository jsii --domain "${CODE_ARTIFACT_DOMAIN}" --domain-owner "${CODE_ARTIFACT_OWNER}"
      - aws codeartifact login --tool dotnet --repository jsii --domain "${CODE_ARTIFACT_DOMAIN}" --domain-owner "${CODE_ARTIFACT_OWNER}"
      - tree dist
      - npm publish
      - twine upload --repository codeartifact ./dist/python/*.tar.gz
      - dotnet nuget push ./dist/dotnet/*.nupkg -s "$(aws codeartifact get-repository-endpoint --domain cdk-extensions --repository jsii --format nuget --query repositoryEndpoint --output text)"